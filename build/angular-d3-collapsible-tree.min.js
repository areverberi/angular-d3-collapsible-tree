"use strict";function collapsibleTree(){return{restrict:"E",scope:{width:"=",height:"=",radius:"=",nodes:"=",onNodeClick:"&"},link:function(a,b){function c(b){var f=d3.event&&d3.event.altKey?5e3:500,g=k.nodes(e).reverse();g.forEach(function(a){a.y=180*a.depth});var h=m.selectAll("g.node").data(g,function(a){return a.id||(a.id=++i)}),n=h.enter().append("svg:g").attr("class","node").attr("transform",function(a){return"translate("+b.y0+","+b.x0+")"}).on("click",function(b){d(b),a.onNodeClick&&a.onNodeClick({id:b.id}),c(b)});n.append("svg:circle").attr("r",1e-5).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),n.append("svg:text").attr("dy",""+(2*j+10)).attr("text-anchor",function(a){return"middle"}).text(function(a){return a.name}).style("fill-opacity",1e-5);var o=h.transition().duration(f).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});o.select("circle").attr("r",j).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),o.select("text").style("fill-opacity",1);var p=h.exit().transition().duration(f).attr("transform",function(a){return"translate("+b.y+","+b.x+")"}).remove();p.select("circle").attr("r",1e-6),p.select("text").style("fill-opacity",1e-6);var q=m.selectAll("path.link").data(k.links(g),function(a){return a.target.id});q.enter().insert("svg:path","g").attr("class","link").attr("d",function(a){var c={x:b.x0,y:b.y0};return l({source:c,target:c})}).transition().duration(f).attr("d",l),q.transition().duration(f).attr("d",l),q.exit().transition().duration(f).attr("d",function(a){var c={x:b.x,y:b.y};return l({source:c,target:c})}).remove(),g.forEach(function(a){a.x0=a.x,a.y0=a.y})}function d(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null)}var e,f=[20,120,20,120],g=1280-f[1]-f[3],h=800-f[0]-f[2],i=0,j=a.radius||18,k=d3.layout.tree().size([h,g]),l=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),m=d3.select("collapsible-tree").append("svg:svg").attr("width",a.width).attr("height",a.height).append("svg:g").attr("transform","translate("+f[3]+","+f[0]+")");a.$watch("nodes",function(){function b(a){a.children&&(a.children.forEach(b),d(a))}a.nodes&&(e=angular.copy(a.nodes),e.x0=h/2,e.y0=0,e.children&&e.children.forEach(b),c(e))},!0)}}}var app=angular.module("renderteam.collapsibleTree",[]);app.directive("collapsibleTree",collapsibleTree),collapsibleTree.$inject=[];